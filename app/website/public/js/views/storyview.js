// Generated by CoffeeScript 1.2.1-pre
(function() {
  var StoryView,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  StoryView = (function() {

    StoryView.name = 'StoryView';

    function StoryView(story) {
      this.story = story;
      this.cancelAuthorRequest = __bind(this.cancelAuthorRequest, this);

      this.sendAuthorRequest = __bind(this.sendAuthorRequest, this);

      this.showAuthorRequest = __bind(this.showAuthorRequest, this);

      $('.author-request-btn').click(this.showAuthorRequest);
      $('.author-request-form .send').click(this.sendAuthorRequest);
      $('.author-request-form .cancel').click(this.cancelAuthorRequest);
    }

    StoryView.prototype.showAuthorRequest = function() {
      $('.author-request-form').show();
      return false;
    };

    StoryView.prototype.sendAuthorRequest = function() {
      var _this = this;
      return $.post("/stories/" + story + "/messages", {
        type: 'AUTHOR_ACCESS_REQUEST',
        message: $('.author-request-form textarea').val()
      }, function(response) {
        debugger;        if (response.success) {
          $('.author-request-form').hide();
          $('.author-request-form textarea').val('');
          $('.author-request-btn').replaceWith('<span>Request sent to owner.</span>');
          return false;
        }
      });
    };

    StoryView.prototype.cancelAuthorRequest = function() {
      $('.author-request-form').hide();
      $('.author-request-form textarea').val('');
      return false;
    };

    return StoryView;

  })();

  SocialTypist.StoryView = StoryView;

}).call(this);
