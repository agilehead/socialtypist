// Generated by CoffeeScript 1.2.1-pre
(function() {
  var StoryView,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  StoryView = (function() {

    StoryView.name = 'StoryView';

    function StoryView(story) {
      this.story = story;
      this.forkStory = __bind(this.forkStory, this);

      this.cancelAuthorRequest = __bind(this.cancelAuthorRequest, this);

      this.sendAuthorRequest = __bind(this.sendAuthorRequest, this);

      this.showAuthorRequest = __bind(this.showAuthorRequest, this);

      $('.author-request-btn').click(this.showAuthorRequest);
      $('.author-request-form .send').click(this.sendAuthorRequest);
      $('.author-request-form .cancel').click(this.cancelAuthorRequest);
      $('.contribute-section .fork-story').click(this.forkStory);
    }

    StoryView.prototype.showAuthorRequest = function() {
      $('.author-request-form').show();
      return false;
    };

    StoryView.prototype.sendAuthorRequest = function() {
      var _this = this;
      return $.post("/stories/" + story + "/authorRequest", {
        message: $('.author-request-form textarea').val()
      }, function(response) {
        if (response.success) {
          $('.author-request-form').hide();
          $('.author-request-form textarea').val('');
          $('.author-request-btn').replaceWith('<span>Request sent to owner.</span>');
          return false;
        }
      });
    };

    StoryView.prototype.cancelAuthorRequest = function() {
      $('.author-request-form').hide();
      $('.author-request-form textarea').val('');
      return false;
    };

    StoryView.prototype.forkStory = function() {
      $('body').append('\
            <div class="modal" id="modal-box">\
                <div class="modal-header">\
                    <a class="close" data-dismiss="modal">Ã—</a>\
                    <h3>Fork a story</h3>\
                </div>\
                <div class="modal-body">\
                    <p>\
                        <label>You are creating a copy of this story. Give it a new name.</label>\
                        <input type="text" style="width:400px" />\
                    </p>\
                </div>\
                <div class="modal-footer">\
                    <a href="#" class="btn btn-primary">Fork</a>\
                    <a href="#">cancel</a>\
                </div>\
            </div>');
      return $('#modal-box').modal();
      /*
              $.post "/stories/#{story}/fork", { }, (response) =>
                  
                  if response.success
                      window.location.href = "/stories/#{response.forkedStory}/edit"
      */

    };

    return StoryView;

  })();

  SocialTypist.StoryView = StoryView;

}).call(this);
